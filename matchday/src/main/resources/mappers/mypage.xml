<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
 <!-- mypage.xml -->
 
 <mapper namespace="mypage">
    
    
    <!-- 마이페이지 항목 불러오기 -->
    <select id="getUserById" parameterType="String" resultType="kr.co.matchday.mypage.MypageDTO">
        SELECT * FROM users WHERE UserID = #{userID}
    </select>
    
    <!-- 마이페이지 수정 -->
    <update id="updateUser" parameterType="kr.co.matchday.mypage.MypageDTO">
        UPDATE users
        SET Password = #{password},
            Email = #{email},
            Zipcode = #{zipcode},
            Address1 = #{address1},
            Address2 = #{address2},
            Number = #{number}
        WHERE UserID = #{userID}
    </update>
    
     <!-- 회원 등급을 'F'로 변경 -->
    <update id="updateUserGradeToF" parameterType="kr.co.matchday.mypage.MypageDTO">
        UPDATE users
        SET Grade = 'F'
        WHERE UserID = #{userID}
    </update>
    
    <!-- 포인트 적립 내역 조회 쿼리 -->
    <select id="getPointHistoryList" resultType="kr.co.matchday.point.PointHistoryDTO">
        SELECT
            pointhistoryid,
            userid,
            pointcategoryid,
            pointtype,
            reviewid,
            pointsource,
            pointamount,
            pointcreationdate,
            pointusedate
        FROM
            pointhistory
        WHERE
            userid = #{userid}
        ORDER BY
            pointhistoryid DESC
    </select>
    
    <!-- 쿠폰목록 조회 쿠폰마스터의 정보를 가져오기위해 조인 -->
    <select id="selectCouponList" resultType="kr.co.matchday.coupon.CouponDTO">
        SELECT c.couponid, c.coupontypeid, c.userid, c.usage, 
               cm.coupontypename, cm.startdate, cm.enddate, cm.applicationcategory
        FROM coupon c
        JOIN couponmaster cm ON c.coupontypeid = cm.coupontypeid
        where c.userid = #{userid}
    </select>
</mapper>

