<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
 <mapper namespace="goods">
 
 
 	<insert id="insert" parameterType="kr.co.matchday.goods.GoodsDTO">
	    INSERT INTO goods(goodsid, category, productname, description, size, price, stockquantity, issoldout, filename, filesize, regdate, caution, deliveryreturnsexchangesinfo)
	    VALUES(#{goodsid}, #{category}, #{productname}, #{description}, #{size}, #{price}, #{stockquantity}, #{issoldout}, #{filename}, #{filesize}, #{regdate}, #{caution}, #{deliveryreturnsexchangesinfo})
	</insert>
	
	<select id="list" resultType="kr.co.matchday.goods.GoodsDTO">
	   	SELECT goodsid, category, productname, description, size, price, stockquantity, issoldout, filename, filesize, regdate, caution, deliveryreturnsexchangesinfo
        FROM goods
        ORDER BY productname
	</select>
	
	<select id="search" resultType="kr.co.matchday.goods.GoodsDTO" parameterType="String">
	    SELECT goodsid, category, productname, description, size, price, stockquantity, issoldout, filename, filesize, regdate, caution, deliveryreturnsexchangesinfo
	    FROM goods
	    WHERE productname LIKE #{keyword}
	    ORDER BY productname
	</select>
	
	<select id="detail" resultType="kr.co.matchday.goods.GoodsDTO" parameterType="String">
	    SELECT goodsid, category, productname, description, size, price, stockquantity, issoldout, filename, filesize, regdate, caution, deliveryreturnsexchangesinfo
	    FROM goods
	    WHERE goodsid = #{goodsid}
	</select>
	
	<update id="update" parameterType="kr.co.matchday.goods.GoodsDTO">
	    UPDATE goods
	    SET category = #{category},
	        productname = #{productname},
	        description = #{description},
	        size = #{size},
	        price = #{price},
	        stockquantity = #{stockquantity},
	        issoldout = #{issoldout},
	        filename = #{filename},
	        filesize = #{filesize},
	        regdate = #{regdate},
	        caution = #{caution},
	        deliveryreturnsexchangesinfo = #{deliveryreturnsexchangesinfo}
	    WHERE goodsid = #{goodsid}
	</update>
	
	<delete id="delete" parameterType="String">
	    DELETE FROM goods
	    WHERE goodsid = #{goodsid}
	</delete>
	
	<select id="filename" resultType="java.lang.String">
	<!-- 굿즈 ID에 해당하는 파일명 조회 -->
	    SELECT filename
	    FROM goods
	    WHERE goodsid = #{goodsid}
	</select>
	
	<!-- 전체 게시물 목록 조회 추가 코드 시작-->
    <select id="listWithPaging" resultType="kr.co.matchday.goods.GoodsDTO" parameterType="map">
        SELECT goodsid, category, productname, description, size, price, stockquantity, issoldout, filename, filesize, regdate, caution, deliveryreturnsexchangesinfo
        FROM goods
        ORDER BY productname
        LIMIT #{limit} OFFSET #{offset}
    </select>

    <!-- 전체 게시물 수 조회 -->
    <select id="countGoods" resultType="int">
        SELECT COUNT(*) FROM goods
    </select>
	
	<insert id="stockinsert" parameterType="kr.co.matchday.goods.StockDTO">
		INSERT INTO stock(goodsid, size, stockquantity)
		VALUES(#{goodsid}, #{size}, #{stockquantity})
	</insert>

	<select id="stocklist" resultType="kr.co.matchday.goods.StockDTO">
	   	SELECT goodsid, size, stockquantity
        FROM stock
        WHERE goodsid = #{goodsid}
        ORDER BY FIELD(size, 'FREE', 'S', 'M', 'L', 'XL')
	</select>

	<update id="stockupdate" parameterType="kr.co.matchday.goods.StockDTO">
		UPDATE stock
		SET stockquantity = stockquantity - #{stockquantity}
		WHERE goodsid = #{goodsid} AND size = #{size};
	</update>
	
	<delete id="stockdelete" parameterType="kr.co.matchday.goods.StockDTO">
		DELETE from stock
		WHERE goodsid = #{goodsid}
	</delete>
	
	
	
	
	<!-- 구매하기 하고나서 추가 
		<update id="stockupdate" parameterType="kr.co.matchday.goods.StockDTO">
		UPDATE stock
		SET stockquantity = stockquantity-1
		WHERE goodsid = #{goodsid} AND size = #{size};
	</update> -->
	

	
	
	
 </mapper>