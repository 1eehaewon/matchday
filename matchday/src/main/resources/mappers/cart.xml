<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cart">

    <!-- 장바구니에 새 상품을 추가하는 쿼리 -->
    <insert id="insert" parameterType="kr.co.matchday.cart.CartDTO">
        INSERT INTO cart (userid, goodsid, quantity, unitprice, totalprice, size)
        VALUES (#{userid}, #{goodsid}, #{quantity}, #{unitprice}, #{totalprice}, #{size})
    </insert>
    
    <!-- 장바구니에 이미 존재하는 상품의 수량과 총 가격을 업데이트하는 쿼리 -->
    <update id="updateQuantity" parameterType="kr.co.matchday.cart.CartDTO">
        UPDATE cart
        SET quantity = #{quantity},
            totalprice = #{totalprice}
        WHERE cartid = #{cartid}
    </update>

    <!-- 장바구니에 특정 사용자, 상품, 사이즈가 이미 존재하는지 확인하는 쿼리 -->
    <select id="checkIfExists" parameterType="kr.co.matchday.cart.CartDTO" resultType="kr.co.matchday.cart.CartDTO">
        SELECT * FROM cart
        WHERE userid = #{userid} AND goodsid = #{goodsid} AND size = #{size}
    </select>

    <!-- 특정 사용자의 장바구니 목록을 조회하는 쿼리 -->
    <select id="getCartList" parameterType="String" resultType="kr.co.matchday.cart.CartDTO">
        SELECT * FROM cart WHERE userid = #{userid}
    </select>
    
    <!-- 장바구니에서 특정 cartid를 가진 상품을 삭제하는 쿼리 -->
    <delete id="delete" parameterType="int">
        DELETE FROM cart WHERE cartid = #{cartid}
    </delete>

    <!-- 장바구니에서 여러 개의 cartid를 가진 상품을 동시에 삭제하는 쿼리 -->
    <delete id="deleteMultiple" parameterType="list">
        DELETE FROM cart WHERE cartid IN
        <foreach item="cartid" collection="list" open="(" separator="," close=")">
            #{cartid}
        </foreach>
    </delete>
    
    <!-- 장바구니에서 여러 개의 cartid를 가진 상품을 조회하는 쿼리 -->
    <select id="getCartItems" parameterType="java.util.List" resultType="kr.co.matchday.cart.CartDTO">
        SELECT * FROM cart
        WHERE cartid IN
        <foreach item="cartid" collection="list" open="(" separator="," close=")">
            #{cartid}
        </foreach>
    </select>

</mapper>
